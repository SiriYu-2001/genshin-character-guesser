/*****************************************************
 *  ① 角色数据直接写在脚本里 —— 不再 fetch()
 *****************************************************/
const characters = [
    {
      "角色": "刻晴",
      "武器": "单手剑",
      "元素": "雷",
      "突破属性": "暴击伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "爱可菲",
      "武器": "长柄武器",
      "元素": "冰",
      "突破属性": "暴击率",
      "国家": "枫丹",
      "首次UP大版本": "5",
      "定位": [
        "副C",
        "辅助"
      ]
    },
    {
      "角色": "瓦雷莎",
      "武器": "法器",
      "元素": "雷",
      "突破属性": "暴击率",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "梦见月瑞希",
      "武器": "法器",
      "元素": "风",
      "突破属性": "元素精通",
      "国家": "稻妻",
      "首次UP大版本": "5",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "茜特拉莉",
      "武器": "法器",
      "元素": "冰",
      "突破属性": "元素精通",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "玛薇卡",
      "武器": "双手剑",
      "元素": "火",
      "突破属性": "暴击伤害",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "主C",
        "副C",
        "辅助"
      ]
    },
    {
      "角色": "恰斯卡",
      "武器": "弓",
      "元素": "风",
      "突破属性": "暴击率",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "希诺宁",
      "武器": "单手剑",
      "元素": "岩",
      "突破属性": "防御力",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "玛拉妮",
      "武器": "法器",
      "元素": "水",
      "突破属性": "暴击率",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "基尼奇",
      "武器": "双手剑",
      "元素": "草",
      "突破属性": "暴击伤害",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "艾梅莉埃",
      "武器": "长柄武器",
      "元素": "草",
      "突破属性": "暴击伤害",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "克洛琳德",
      "武器": "单手剑",
      "元素": "雷",
      "突破属性": "暴击率",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "希格雯",
      "武器": "弓",
      "元素": "水",
      "突破属性": "生命值",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "阿蕾齐诺",
      "武器": "长柄武器",
      "元素": "火",
      "突破属性": "暴击伤害",
      "国家": "至冬",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "千织",
      "武器": "单手剑",
      "元素": "岩",
      "突破属性": "暴击率",
      "国家": "稻妻",
      "首次UP大版本": "4",
      "定位": [
        "副C",
        "主C"
      ]
    },
    {
      "角色": "闲云",
      "武器": "法器",
      "元素": "风",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "4",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "娜维娅",
      "武器": "双手剑",
      "元素": "岩",
      "突破属性": "暴击伤害",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "芙宁娜",
      "武器": "单手剑",
      "元素": "水",
      "突破属性": "暴击率",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "副C",
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "那维莱特",
      "武器": "法器",
      "元素": "水",
      "突破属性": "暴击伤害",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "莱欧斯利",
      "武器": "法器",
      "元素": "冰",
      "突破属性": "暴击伤害",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "林尼",
      "武器": "弓",
      "元素": "火",
      "突破属性": "暴击率",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "白术",
      "武器": "法器",
      "元素": "草",
      "突破属性": "生命值",
      "国家": "璃月",
      "首次UP大版本": "3",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "迪希雅",
      "武器": "双手剑",
      "元素": "火",
      "突破属性": "生命值",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "生存",
        "副C"
      ]
    },
    {
      "角色": "艾尔海森",
      "武器": "单手剑",
      "元素": "草",
      "突破属性": "元素伤害",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "流浪者",
      "武器": "法器",
      "元素": "风",
      "突破属性": "暴击率",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "纳西妲",
      "武器": "法器",
      "元素": "草",
      "突破属性": "元素精通",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "副C",
        "辅助"
      ]
    },
    {
      "角色": "赛诺",
      "武器": "长柄武器",
      "元素": "雷",
      "突破属性": "暴击伤害",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "妮露",
      "武器": "单手剑",
      "元素": "水",
      "突破属性": "生命值",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "提纳里",
      "武器": "弓",
      "元素": "草",
      "突破属性": "元素伤害",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "夜兰",
      "武器": "弓",
      "元素": "水",
      "突破属性": "暴击率",
      "国家": "璃月",
      "首次UP大版本": "2",
      "定位": [
        "主C",
        "副C",
        "辅助"
      ]
    },
    {
      "角色": "神里绫人",
      "武器": "单手剑",
      "元素": "水",
      "突破属性": "暴击伤害",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "八重神子",
      "武器": "法器",
      "元素": "雷",
      "突破属性": "暴击率",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "申鹤",
      "武器": "长柄武器",
      "元素": "冰",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "2",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "荒泷一斗",
      "武器": "双手剑",
      "元素": "岩",
      "突破属性": "暴击率",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "埃洛伊",
      "武器": "弓",
      "元素": "冰",
      "突破属性": "元素伤害",
      "国家": "异世界",
      "首次UP大版本": "2",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "珊瑚宫心海",
      "武器": "法器",
      "元素": "水",
      "突破属性": "元素伤害",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "生存",
        "主C"
      ]
    },
    {
      "角色": "雷电将军",
      "武器": "长柄武器",
      "元素": "雷",
      "突破属性": "元素充能效率",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "主C"
      ]
    },
    {
      "角色": "宵宫",
      "武器": "弓",
      "元素": "火",
      "突破属性": "暴击率",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "神里绫华",
      "武器": "单手剑",
      "元素": "冰",
      "突破属性": "暴击伤害",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "枫原万叶",
      "武器": "单手剑",
      "元素": "风",
      "突破属性": "元素精通",
      "国家": "稻妻",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "优菈",
      "武器": "双手剑",
      "元素": "冰",
      "突破属性": "暴击伤害",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "胡桃",
      "武器": "长柄武器",
      "元素": "火",
      "突破属性": "暴击伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "魈",
      "武器": "长柄武器",
      "元素": "风",
      "突破属性": "暴击率",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "阿贝多",
      "武器": "单手剑",
      "元素": "岩",
      "突破属性": "元素伤害",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "甘雨",
      "武器": "弓",
      "元素": "冰",
      "突破属性": "暴击伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "主C",
        "副C"
      ]
    },
    {
      "角色": "达达利亚",
      "武器": "弓",
      "元素": "水",
      "突破属性": "元素伤害",
      "国家": "至冬",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "钟离",
      "武器": "长柄武器",
      "元素": "岩",
      "突破属性": "元素伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "莫娜",
      "武器": "法器",
      "元素": "水",
      "突破属性": "元素充能效率",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "七七",
      "武器": "单手剑",
      "元素": "冰",
      "突破属性": "治疗加成",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "生存"
      ]
    },
    {
      "角色": "可莉",
      "武器": "法器",
      "元素": "火",
      "突破属性": "元素伤害",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "主C",
        "辅助"
      ]
    },
    {
      "角色": "温迪",
      "武器": "弓",
      "元素": "风",
      "突破属性": "元素充能效率",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "迪卢克",
      "武器": "双手剑",
      "元素": "火",
      "突破属性": "暴击率",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "琴",
      "武器": "单手剑",
      "元素": "风",
      "突破属性": "治疗加成",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "伊法",
      "武器": "法器",
      "元素": "风",
      "突破属性": "元素精通",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "主C",
        "生存"
      ]
    },
    {
      "角色": "伊安珊",
      "武器": "长柄武器",
      "元素": "雷",
      "突破属性": "攻击力",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "蓝砚",
      "武器": "法器",
      "元素": "风",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "5",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "欧洛仑",
      "武器": "弓",
      "元素": "雷",
      "突破属性": "攻击力",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "辅助",
        "副C"
      ]
    },
    {
      "角色": "卡齐娜",
      "武器": "长柄武器",
      "元素": "岩",
      "突破属性": "元素伤害",
      "国家": "纳塔",
      "首次UP大版本": "5",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "赛索斯",
      "武器": "弓",
      "元素": "雷",
      "突破属性": "元素精通",
      "国家": "须弥",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "嘉明",
      "武器": "双手剑",
      "元素": "火",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "夏沃蕾",
      "武器": "长柄武器",
      "元素": "火",
      "突破属性": "生命值",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "夏洛蒂",
      "武器": "法器",
      "元素": "冰",
      "突破属性": "攻击力",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "生存"
      ]
    },
    {
      "角色": "菲米尼",
      "武器": "双手剑",
      "元素": "冰",
      "突破属性": "攻击力",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "琳妮特",
      "武器": "单手剑",
      "元素": "风",
      "突破属性": "元素伤害",
      "国家": "枫丹",
      "首次UP大版本": "4",
      "定位": [
        "辅助",
        "主C"
      ]
    },
    {
      "角色": "绮良良",
      "武器": "单手剑",
      "元素": "草",
      "突破属性": "生命值",
      "国家": "稻妻",
      "首次UP大版本": "3",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "卡维",
      "武器": "双手剑",
      "元素": "草",
      "突破属性": "元素精通",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "米卡",
      "武器": "长柄武器",
      "元素": "冰",
      "突破属性": "生命值",
      "国家": "蒙德",
      "首次UP大版本": "3",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "瑶瑶",
      "武器": "长柄武器",
      "元素": "草",
      "突破属性": "生命值",
      "国家": "璃月",
      "首次UP大版本": "3",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "珐露珊",
      "武器": "弓",
      "元素": "风",
      "突破属性": "攻击力",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "辅助",
        "副C"
      ]
    },
    {
      "角色": "莱依拉",
      "武器": "单手剑",
      "元素": "冰",
      "突破属性": "生命值",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "生存"
      ]
    },
    {
      "角色": "坎蒂丝",
      "武器": "长柄武器",
      "元素": "水",
      "突破属性": "生命值",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "多莉",
      "武器": "双手剑",
      "元素": "雷",
      "突破属性": "生命值",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "柯莱",
      "武器": "弓",
      "元素": "草",
      "突破属性": "攻击力",
      "国家": "须弥",
      "首次UP大版本": "3",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "鹿野院平藏",
      "武器": "法器",
      "元素": "风",
      "突破属性": "元素伤害",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "主C"
      ]
    },
    {
      "角色": "久岐忍",
      "武器": "单手剑",
      "元素": "雷",
      "突破属性": "生命值",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "云堇",
      "武器": "长柄武器",
      "元素": "岩",
      "突破属性": "元素充能效率",
      "国家": "璃月",
      "首次UP大版本": "2",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "五郎",
      "武器": "弓",
      "元素": "岩",
      "突破属性": "元素伤害",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "托马",
      "武器": "长柄武器",
      "元素": "火",
      "突破属性": "攻击力",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "九条裟罗",
      "武器": "弓",
      "元素": "雷",
      "突破属性": "攻击力",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "副C"
      ]
    },
    {
      "角色": "早柚",
      "武器": "双手剑",
      "元素": "风",
      "突破属性": "元素精通",
      "国家": "稻妻",
      "首次UP大版本": "2",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "烟绯",
      "武器": "法器",
      "元素": "火",
      "突破属性": "元素伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "主C",
        "生存"
      ]
    },
    {
      "角色": "罗莎莉亚",
      "武器": "长柄武器",
      "元素": "冰",
      "突破属性": "攻击力",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "副C"
      ]
    },
    {
      "角色": "辛焱",
      "武器": "双手剑",
      "元素": "火",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "生存",
        "主C"
      ]
    },
    {
      "角色": "迪奥娜",
      "武器": "弓",
      "元素": "冰",
      "突破属性": "元素伤害",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "砂糖",
      "武器": "法器",
      "元素": "风",
      "突破属性": "元素伤害",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "重云",
      "武器": "双手剑",
      "元素": "冰",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "诺艾尔",
      "武器": "双手剑",
      "元素": "岩",
      "突破属性": "防御力",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "主C",
        "生存"
      ]
    },
    {
      "角色": "班尼特",
      "武器": "单手剑",
      "元素": "火",
      "突破属性": "元素充能效率",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "菲谢尔",
      "武器": "弓",
      "元素": "雷",
      "突破属性": "攻击力",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "凝光",
      "武器": "法器",
      "元素": "岩",
      "突破属性": "元素伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "副C",
        "主C"
      ]
    },
    {
      "角色": "行秋",
      "武器": "单手剑",
      "元素": "水",
      "突破属性": "攻击力",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "北斗",
      "武器": "双手剑",
      "元素": "雷",
      "突破属性": "元素伤害",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "香菱",
      "武器": "长柄武器",
      "元素": "火",
      "突破属性": "元素精通",
      "国家": "璃月",
      "首次UP大版本": "1",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "安柏",
      "武器": "弓",
      "元素": "火",
      "突破属性": "攻击力",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    },
    {
      "角色": "雷泽",
      "武器": "双手剑",
      "元素": "雷",
      "突破属性": "物理伤害",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "主C"
      ]
    },
    {
      "角色": "凯亚",
      "武器": "单手剑",
      "元素": "冰",
      "突破属性": "元素充能效率",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "副C"
      ]
    },
    {
      "角色": "芭芭拉",
      "武器": "法器",
      "元素": "水",
      "突破属性": "生命值",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助",
        "生存"
      ]
    },
    {
      "角色": "丽莎",
      "武器": "法器",
      "元素": "雷",
      "突破属性": "元素精通",
      "国家": "蒙德",
      "首次UP大版本": "1",
      "定位": [
        "辅助"
      ]
    }
  ];
  
  /*****************************************************
   *  ② 全局状态
   *****************************************************/
  let answer     = null;   // 当前谜底
  let guessCount = 0;      // 已猜次数
  const MAX_TRY  = 5;
  
  /*****************************************************
   *  ③ 页面加载后立即初始化
   *****************************************************/
  document.addEventListener("DOMContentLoaded", () => {
    populateDatalist();
    startNewRound();
    document.getElementById("guessBtn"   ).addEventListener("click", handleGuess);
    document.getElementById("restartBtn" ).addEventListener("click", startNewRound);
  });
  
  /*****************************************************
   *  ④ 填充 datalist（自动联想）
   *****************************************************/
  function populateDatalist() {
    const dl = document.getElementById("nameList");
    dl.innerHTML = "";
    characters.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c["角色"];
      dl.appendChild(opt);
    });
  }
  
  /*****************************************************
   *  ⑤ 开局 / 重新开始
   *****************************************************/
  // function startNewRound() {
  //   answer = characters[Math.floor(Math.random() * characters.length)];
  //   guessCount = 0;
  //   console.log("本局答案：", answer["角色"]);   // 调试用
  //   document.getElementById("results").innerHTML = "";
  //   document.getElementById("tableHeader").style.display = "none";
  //   document.getElementById("guessInput").value    = "";
  //   document.getElementById("guessInput").disabled = false;
  //   document.getElementById("guessBtn"  ).disabled = false;
  // }
  /* ---------- 开局 / 重新开始 ---------- */
  function startNewRound() {
    // 1. 随机抽取新的谜底角色
    answer     = characters[Math.floor(Math.random() * characters.length)];
    guessCount = 0;
    console.log("本局答案：", answer["角色"]);   // 开发调试用，可删

    // 2. 清空历史猜测列
    document.getElementById("results").innerHTML = "";

    // 3. 清空上一局的结果提示并移除颜色样式
    const endBox = document.getElementById("endMessage");
    endBox.innerHTML = "";
    endBox.style.color = "";

    // 4. 重置输入框和按钮
    const input = document.getElementById("guessInput");
    input.value    = "";
    input.disabled = false;
    document.getElementById("guessBtn").disabled = false;
  }

  
  /*****************************************************
   *  ⑥ 处理一次猜测
   *****************************************************/
  function handleGuess() {
    const name = document.getElementById("guessInput").value.trim();
    if (!name) return;
  
    const guessChar = characters.find(c => c["角色"] === name);
    if (!guessChar) {
      alert("未找到该角色，请检查名字！");
      return;
    }
  
    if (guessCount === 0)            // 首次猜测时显示表头
      document.getElementById("tableHeader").style.display = "flex";
  
    renderResultRow(guessChar);
  
    if (guessChar["角色"] === answer["角色"]) {
      endGame(true);
      return;
    }
  
    guessCount++;
    if (guessCount >= MAX_TRY) endGame(false);
    document.getElementById("guessInput").value = "";
  }
  
  /*****************************************************
   *  ⑦ 绘制结果行
   *****************************************************/
  function renderResultRow(guessChar) {
    const attrs = ["角色", "武器", "元素", "突破属性", "国家", "首次UP大版本", "定位"];
    const row   = document.createElement("div");
    row.className = "result-row";
  
    attrs.forEach(attr => {
      const cell = document.createElement("div");
      const gVal = guessChar[attr];
      const aVal = answer[attr];
      cell.textContent = Array.isArray(gVal) ? gVal.join(",") : gVal;
  
      if (attr === "定位") {
        const gSet = new Set(gVal), aSet = new Set(aVal);
        const inter = [...gSet].filter(x => aSet.has(x));
        if (inter.length === 0)          cell.classList.add("mismatch");
        else if (gSet.size === aSet.size && inter.length === gSet.size)
                                         cell.classList.add("match");
        else                             cell.classList.add("partial");
      } else {
        cell.classList.add(gVal === aVal ? "match" : "mismatch");
      }
      row.appendChild(cell);
    });
  
    document.getElementById("results").appendChild(row);
  }
  
  /*****************************************************
   *  ⑧ 结束游戏（胜/负）
   *****************************************************/
  // function endGame(isWin) {
  //   document.getElementById("guessInput").disabled = true;
  //   document.getElementById("guessBtn"  ).disabled = true;
  
  //   const msg = document.createElement("div");
  //   msg.style.marginTop  = "10px";
  //   msg.style.fontWeight = "bold";
  //   msg.style.color      = isWin ? "green" : "red";
  //   msg.textContent      = isWin
  //     ? `🎉 恭喜猜对！答案：${answer["角色"]}`
  //     : `😢 很遗憾，正确答案是：${answer["角色"]}`;
  //   document.getElementById("results").appendChild(msg);
  // }
  function endGame(isWin) {
    document.getElementById("guessInput").disabled = true;
    document.getElementById("guessBtn"  ).disabled = true;
  
    const endBox = document.getElementById("endMessage");
    endBox.textContent = (isWin
      ? "🎉 恭喜你，正确答案是："
      : "😢 很遗憾，正确答案是：") + answer["角色"];
    endBox.style.color = isWin ? "green" : "red";
  }
  